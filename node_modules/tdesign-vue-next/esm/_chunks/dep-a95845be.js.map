{"version":3,"file":"dep-a95845be.js","sources":["../../../shared/hooks/useMutationObservable/index.ts","../../../common/js/utils/getColorTokenColor.ts","../../../shared/hooks/useVariables/index.ts"],"sourcesContent":["import { onBeforeUnmount, onMounted, ref, watch } from 'vue';\nimport { debounce, isEqual } from 'lodash-es';\n\nexport interface MutationCallback {\n  (mutations: MutationRecord[]): void;\n}\n\ninterface Options {\n  debounceTime?: number;\n  config?: MutationObserverInit;\n}\n\nconst DEFAULT_OPTIONS: Options = {\n  debounceTime: 0,\n  config: {\n    attributes: true,\n    childList: true,\n    characterData: true,\n    subtree: true,\n  },\n};\n\n/**\n * useMutationObservable\n * @param targetEl 监听对象\n * @param callback 回调方法\n * @param options 配置项\n */\nexport function useMutationObservable(\n  targetEl: HTMLElement | null,\n  callback: MutationCallback,\n  options: Options = DEFAULT_OPTIONS,\n) {\n  const mergedOptions = ref<Options>({ ...DEFAULT_OPTIONS, ...options });\n  let observer: MutationObserver | null = null;\n\n  const initObserver = () => {\n    if (!targetEl) return;\n\n    const { debounceTime = 0, config = DEFAULT_OPTIONS.config } = mergedOptions.value;\n    const handler: MutationCallback = (...args) => {\n      callback?.(...args);\n    };\n\n    observer?.disconnect();\n    observer = new MutationObserver(debounceTime > 0 ? debounce(handler, debounceTime) : handler);\n    observer.observe(targetEl, config);\n  };\n\n  watch(\n    () => options,\n    (newOptions) => {\n      if (!isEqual(newOptions, mergedOptions.value)) {\n        mergedOptions.value = { ...DEFAULT_OPTIONS, ...newOptions };\n        initObserver();\n      }\n    },\n    { deep: true },\n  );\n\n  onMounted(initObserver);\n  onBeforeUnmount(() => observer?.disconnect());\n}\n\nexport default useMutationObservable;\n","/**\n * 获取颜色token的色值\n * @example getColorTokenColor('--td-brand-color')\n * @returns string\n */\nexport const getColorTokenColor = (token: string): string => {\n  const targetElement = document?.documentElement;\n  const styles = getComputedStyle(targetElement);\n  return styles.getPropertyValue(token).trim() ?? '';\n};\n\nexport default getColorTokenColor;\n","import { ref } from 'vue';\nimport type { Ref } from 'vue';\nimport { isString } from 'lodash-es';\nimport { THEME_MODE } from '@tdesign/common-js/common';\nimport getColorTokenColor from '@tdesign/common-js/utils/getColorTokenColor';\nimport useMutationObservable from '../useMutationObservable';\n\n/**\n * useVariables\n * @param variable CSS 变量名\n * @example\n *   const { textColor, brandColor } = useVariables({\n *      textColor: '--td-color-primary',\n *      brandColor: '--td-brand-color',\n *   });\n */\nexport function useVariables<T extends Record<string, string>>(variables: T): Record<keyof T, Ref<string>> {\n  const values = {} as Record<keyof T, Ref<string>>;\n  let varsArray: string[] = [];\n\n  varsArray = Object.values(variables);\n  Object.entries(variables).forEach(([key, varName]) => {\n    values[key as keyof T] = ref(getColorTokenColor(varName));\n  });\n\n  varsArray.forEach((varName) => {\n    values[varName as keyof T] = ref(getColorTokenColor(varName));\n  });\n\n  const targetElement = document?.documentElement;\n  useMutationObservable(targetElement, (mutationsList) => {\n    mutationsList.some((mutation) => {\n      if (mutation.type === 'attributes' && mutation.attributeName === THEME_MODE) {\n        if (isString(variables) || Array.isArray(variables)) {\n          varsArray.forEach((varName) => {\n            values[varName].value = getColorTokenColor(varName);\n          });\n        } else {\n          Object.entries(variables).forEach(([key, varName]) => {\n            values[key].value = getColorTokenColor(varName);\n          });\n        }\n        return true;\n      }\n      return false;\n    });\n  });\n\n  return values;\n}\n"],"names":["DEFAULT_OPTIONS","debounceTime","config","attributes","childList","characterData","subtree","useMutationObservable","targetEl","callback","options","arguments","length","undefined","mergedOptions","ref","_objectSpread","observer","initObserver","_observer","_mergedOptions$value","value","_mergedOptions$value$","_mergedOptions$value$2","handler","_len","args","Array","_key","apply","disconnect","MutationObserver","debounce","observe","watch","newOptions","isEqual","deep","onMounted","onBeforeUnmount","_observer2","getColorTokenColor","token","_document","_styles$getPropertyVa","targetElement","document","documentElement","styles","getComputedStyle","getPropertyValue","trim","useVariables","variables","values","varsArray","Object","entries","forEach","_ref","_ref2","_slicedToArray","key","varName","mutationsList","some","mutation","type","attributeName","THEME_MODE","isString","isArray","_ref3","_ref4"],"mappings":"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"}