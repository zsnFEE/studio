{"version":3,"file":"dep-682444b3.js","sources":["../../../shared/hooks/useKeepAnimation/index.ts","../../../shared/hooks/usePopupManager/index.ts"],"sourcesContent":["import { useConfig } from '../useConfig';\n// TODO need refactor\nimport { EAnimationType } from '../../../components/config-provider/utils/context';\n\nconst { expand, ripple, fade } = EAnimationType;\n\nexport function useKeepAnimation() {\n  const { globalConfig } = useConfig('animation');\n\n  const keepAnimation = (type: EAnimationType) => {\n    const animationConfig = globalConfig.value;\n    return animationConfig && !animationConfig.exclude?.includes(type) && animationConfig.include?.includes(type);\n  };\n  return {\n    keepExpand: keepAnimation(expand),\n    keepRipple: keepAnimation(ripple),\n    keepFade: keepAnimation(fade),\n  };\n}\n","// https://github.dev/arco-design/arco-design-vue\nimport { onMounted, onBeforeUnmount, readonly, Ref, ref, watch } from 'vue';\nexport type PopupType = 'popup' | 'dialog' | 'message' | 'drawer';\n\nconst popupStackType = ['dialog', 'drawer'];\nconst POPUP_BASE_Z_INDEX = 1000;\nconst MESSAGE_BASE_Z_INDEX = 5000;\nconst Z_INDEX_STEP = 1;\n\nclass PopupManager {\n  private popupStack = {\n    popup: new Set<number>(),\n    dialog: new Set<number>(),\n    message: new Set<number>(),\n    drawer: new Set<number>(),\n  };\n\n  private zIndexStack: number[] = [];\n\n  private getNextZIndex = (type: PopupType) => {\n    const current =\n      type === 'message'\n        ? Array.from(this.popupStack.message).pop() || MESSAGE_BASE_Z_INDEX\n        : Array.from(this.popupStack.popup).pop() || POPUP_BASE_Z_INDEX;\n    return current + Z_INDEX_STEP;\n  };\n\n  public add = (type: PopupType) => {\n    const zIndex = this.getNextZIndex(type);\n    this.popupStack[type].add(zIndex);\n    if (popupStackType.includes(type)) {\n      this.popupStack.popup.add(zIndex);\n    }\n    this.zIndexStack.push(zIndex);\n    return zIndex;\n  };\n\n  public delete = (zIndex: number, type: PopupType) => {\n    this.popupStack[type].delete(zIndex);\n    if (popupStackType.includes(type)) {\n      this.popupStack.popup.delete(zIndex);\n    }\n    const index = this.zIndexStack.indexOf(zIndex);\n    if (index !== -1) {\n      this.zIndexStack.splice(index, 1);\n    }\n  };\n\n  // 最顶层的交互式弹窗（指Dialog和Drawer）\n  public isTopInteractivePopup = (popupType: PopupType, zIndex: number) => {\n    if (popupStackType.includes(popupType)) {\n      const lastZIndex = this.zIndexStack[this.zIndexStack.length - 1];\n      return zIndex === lastZIndex;\n    }\n\n    if (this.popupStack[popupType]?.size > 1) {\n      return zIndex === Array.from(this.popupStack[popupType]).pop();\n    }\n\n    return true;\n  };\n\n  public getLastZIndex = () => {\n    return this.zIndexStack[this.zIndexStack.length - 1];\n  };\n}\n\nconst popupManager = new PopupManager();\n\nexport function usePopupManager(\n  type: PopupType,\n  {\n    visible,\n    runOnMounted,\n  }: {\n    visible?: Ref<boolean>;\n    runOnMounted?: boolean;\n  } = {},\n) {\n  const zIndex = ref(0);\n\n  const open = () => {\n    zIndex.value = popupManager.add(type);\n  };\n\n  const close = () => {\n    popupManager.delete(zIndex.value, type);\n  };\n\n  const isTopInteractivePopup = () => {\n    if (popupStackType.includes(type)) {\n      return popupManager.isTopInteractivePopup(type, zIndex.value);\n    }\n    return false;\n  };\n\n  watch(\n    () => visible?.value,\n    (visible) => {\n      if (visible) {\n        open();\n      } else {\n        close();\n      }\n    },\n    {\n      immediate: true,\n    },\n  );\n\n  if (runOnMounted) {\n    onMounted(() => {\n      open();\n    });\n\n    onBeforeUnmount(() => {\n      close();\n    });\n  }\n\n  return {\n    zIndex: readonly(zIndex),\n    open,\n    close,\n    isTopInteractivePopup,\n  };\n}\n"],"names":["expand","EAnimationType","ripple","fade","useKeepAnimation","_useConfig","useConfig","globalConfig","keepAnimation","type","_animationConfig$excl","_animationConfig$incl","animationConfig","value","exclude","includes","include","keepExpand","keepRipple","keepFade","popupStackType","POPUP_BASE_Z_INDEX","MESSAGE_BASE_Z_INDEX","Z_INDEX_STEP","PopupManager","_createClass","_this","_classCallCheck","_defineProperty","popup","Set","dialog","message","drawer","current","Array","from","popupStack","pop","zIndex","getNextZIndex","add","zIndexStack","push","index","indexOf","splice","popupType","_this$popupStack$popu","lastZIndex","length","size","popupManager","usePopupManager","_ref","arguments","undefined","visible","runOnMounted","ref","open","close","isTopInteractivePopup","watch","immediate","onMounted","onBeforeUnmount","readonly"],"mappings":"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"}